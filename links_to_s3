import requests, zipfile , os, tempfile , boto3
urls =['https://api.worldbank.org/v2/en/indicator/SL.AGR.EMPL.ZS?downloadformat=csv' , 'https://www.stats.govt.nz/assets/Uploads/Annual-enterprise-survey/Annual-enterprise-survey-2020-financial-year-provisional/Download-data/annual-enterprise-survey-2020-financial-year-provisional-size-bands-csv.csv']

def download_handler(links_list):
    for link in links_list:
        data = requests.get(link)
        tmp = tempfile.NamedTemporaryFile(mode ='wb')
        full_filename = tmp.name
        dirname = os.path.dirname(os.path.abspath(full_filename))
        with open(full_filename, 'wb') as f:
            f.write(data.content)
            f.close()
        try:
            with zipfile.ZipFile(full_filename) as zf:
                zf.extractall(dirname)      
        except:
            os.rename(full_filename , dirname + "/" + os.path.basename(link))
            dirlist = os.listdir(dirname)
    return(dirname , dirlist)

def lambda_handler(event, context):
    bucket = "test-bucket-ilya"
    s3 = boto3.resource('s3')
    upload_folder, upload_files = (download_handler(urls))
    for file in upload_files:
        file_path = upload_folder + "/" + file
        s3.meta.client.upload_file(file_path, bucket, file)
    return()
